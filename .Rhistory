summarize(count = n(),
high_occupancy_rate = mean(occupancy_classifier))
ggplot(occupancy.Panel, aes(date, high_occupancy_rate)) + geom_line() +
labs(title="High Occupancy Rate", x="Hour", y="High Occupancy Rate") + theme_minimal()
occupancy.Panel <- data %>%
group_by(date) %>%
summarize(count = n(),
high_occupancy_rate = mean(occupancy_classifier))
ggplot(occupancy.Panel, aes(date, high_occupancy_rate)) + geom_line() +
labs(title="High Occupancy Rate", x="Date", y="High Occupancy Rate") + theme_minimal()
grid.arrange(
ggplot(weather.Panel, aes(date, count)) + geom_line() +
labs(title="Count", x="Date", y="Count") + theme_minimal(),
ggplot(occupancy.Panel, aes(date, high_occupancy_rate)) + geom_line() +
labs(title="High Occupancy Rate", x="Date", y="High Occupancy Rate") + theme_minimal(),
top="Occupancy Data")
ggplot(weather.Panel, aes(date, count)) + geom_line() +
labs(title="Count", x="Date", y="Count") + theme_minimal()
grid.arrange(
ggplot(occupancy.Panel, aes(date, count)) + geom_line() +
labs(title="Count", x="Date", y="Count") + theme_minimal(),
ggplot(occupancy.Panel, aes(date, high_occupancy_rate)) + geom_line() +
labs(title="High Occupancy Rate", x="Date", y="High Occupancy Rate") + theme_minimal(),
top="Occupancy Data")
View(stations)
from_avg <- data %>%
group_by(from) %>%
summarize(from_avg = mean(occupancy_numeric, na.rm = TRUE))
to_avg <- data %>%
group_by(to) %>%
summarize(to_avg = mean(occupancy_numeric, na.rm = TRUE))
from_avg <- data %>%
group_by(from) %>%
summarize(from_avg = mean(occupancy_classifier, na.rm = TRUE))
to_avg <- data %>%
group_by(to) %>%
summarize(to_avg = mean(occupancy_classifier, na.rm = TRUE))
from_avg <- data %>%
group_by(from) %>%
summarize(from_count = n(),
from_avg = mean(occupancy_classifier, na.rm = TRUE))
to_avg <- data %>%
group_by(to) %>%
summarize(to_count = n(),
to_avg = mean(occupancy_classifier, na.rm = TRUE))
stations <- stations %>%
left_join(from_avg, by = c("code" = "from")) %>%
left_join(to_avg, by = c("code" = "to"))
stations_sf <- stations %>%
st_as_sf(coords = c("longitude", "latitude"), crs = 4326)
ggplot(data = stations_sf %>% filter(!is.na(from_avg))) +
geom_sf(aes(color = from_avg), size = 2) +
scale_color_gradient(low = "grey80", high = "firebrick") +
theme_minimal() +
labs(title = "Average Occupancy: Origin",
color = "Origin Avg",
x = "Longitude",
y = "Latitude")
ggplot(data = stations_sf %>% filter(!is.na(to_avg))) +
geom_sf(aes(color = to_avg), size = 2) +
scale_color_gradient(low = "grey80", high = "firebrick") +
theme_minimal() +
labs(title = "Average Occupancy: Destination",
color = "Dest. Avg",
x = "Longitude",
y = "Latitude")
plot(from_avg, to_avg)
plot(stations$from_avg, stations$to_avg)
abline()
line()
plot(stations$from_avg, stations$to_avg)
cor(stations$from_avg, stations$to_avg)
stations <- read.csv('stations.csv') %>%
mutate(
code = str_extract(URI, "[^/]{9}$"),
Weekday = as.numeric(Weekday),
Weekend = rowMeans(cbind(as.numeric(Saturday), as.numeric(Sunday)), na.rm = TRUE),
Overall = Weekday * 5/7 + Weekend * 2/7,
) %>%
filter(country.code == "be") %>%
select(code, name, longitude, latitude, Weekday, Weekend) %>%
filter(code %in% unique(c(data$from, data$to)))
from_avg <- data %>%
group_by(from) %>%
summarize(from_count = n(),
from_avg = mean(occupancy_classifier, na.rm = TRUE))
to_avg <- data %>%
group_by(to) %>%
summarize(to_count = n(),
to_avg = mean(occupancy_classifier, na.rm = TRUE))
stations <- stations %>%
left_join(from_avg, by = c("code" = "from")) %>%
left_join(to_avg, by = c("code" = "to"))
stations_sf <- stations %>%
st_as_sf(coords = c("longitude", "latitude"), crs = 4326)
stations <- read.csv('stations.csv') %>%
mutate(
code = str_extract(URI, "[^/]{9}$"),
Weekday = as.numeric(Weekday),
Weekend = rowMeans(cbind(as.numeric(Saturday), as.numeric(Sunday)), na.rm = TRUE)
) %>%
filter(country.code == "be") %>%
select(code, name, longitude, latitude, Weekday, Weekend) %>%
filter(code %in% unique(c(data$from, data$to)))
stations <- stations %>%
mutate(Overall = Weekday * 5/7 + Weekend * 2/7) %>%
left_join(from_avg, by = c("code" = "from")) %>%
left_join(to_avg, by = c("code" = "to"))
stations_sf <- stations %>%
st_as_sf(coords = c("longitude", "latitude"), crs = 4326)
stations <- read.csv('stations.csv') %>%
mutate(
code = str_extract(URI, "[^/]{9}$"),
Weekday = as.numeric(Weekday),
Weekend = rowMeans(cbind(as.numeric(Saturday), as.numeric(Sunday)), na.rm = TRUE)
) %>%
filter(country.code == "be") %>%
select(code, name, longitude, latitude, Weekday, Weekend) %>%
filter(code %in% unique(c(data$from, data$to)))
stations <- stations %>%
mutate(Overall = Weekday * 5/7 + Weekend * 2/7) %>%
left_join(from_avg, by = c("code" = "from")) %>%
left_join(to_avg, by = c("code" = "to")) %>%
replace(is.na(.), 0) %>%
mutate(overall_count = from_count + to_count,
overall_avg = (from_avg * from_count + to_avg * to_count) / (from_count + to_count))
cor(stations$Overall, stations$overall_avg)
plot(stations$Overall, stations$overall_avg)
ggplot(data = stations %>% filter(overall_count > 4)) +
geom_plot(aes(Overall, overall_avg), size = 2) +
theme_minimal() +
labs(title = "Passenger Count vs Overall Occupancy",,
x = "Passenger Count",
y = "Overall Occupancy")
ggplot(data = stations %>% filter(overall_count > 4)) +
geom_point(aes(Overall, overall_avg), size = 2) +
theme_minimal() +
labs(title = "Passenger Count vs Overall Occupancy",
x = "Passenger Count",
y = "Overall Occupancy")
ggplot(data = stations %>% filter(overall_count > 5)) +
geom_point(aes(Overall, overall_avg), size = 2) +
theme_minimal() +
labs(title = "Passenger Count vs Overall Occupancy",
x = "Passenger Count",
y = "Overall Occupancy")
ggplot(data = stations %>% filter(overall_count > 9)) +
geom_point(aes(Overall, overall_avg), size = 2) +
theme_minimal() +
labs(title = "Passenger Count vs Overall Occupancy",
x = "Passenger Count",
y = "Overall Occupancy")
ggplot(data = stations %>% filter(overall_count > 4)) +
geom_point(aes(Overall, overall_avg), size = 2) +
theme_minimal() +
labs(title = "Passenger Count vs Overall Occupancy",
x = "Passenger Count",
y = "Overall Occupancy")
data <- data %>%
filter(from %in% stations$code & to %in% stations$code)
od_data <- data %>%
group_by(OD) %>%
#filter(n() > 3) %>%
summarize(
count = n(),
avg_occupancy = mean(occupancy_classifier, na.rm = TRUE),
from = first(from),
to = first(to)
)
od_with_coords <- od_data %>%
left_join(stations, by = c("from" = "code")) %>%
rename(from_long = longitude, from_lat = latitude) %>%
left_join(stations, by = c("to" = "code")) %>%
rename(to_long = longitude, to_lat = latitude)
od_lines <- od_with_coords %>%
filter(!is.na(from_long) & !is.na(to_long)) %>%
rowwise() %>%
mutate(geometry = st_sfc(st_linestring(matrix(c(from_long, from_lat, to_long, to_lat), ncol = 2, byrow = TRUE)), crs = 4326)) %>%
st_as_sf()
ggplot() +
geom_sf(data = stations_sf, color = "black", size = 2) +
geom_sf(data = od_lines, aes(color = avg_occupancy), size = 2, alpha = 0.7) +
scale_color_gradient(low = "grey80", high = "firebrick") +
theme_minimal() +
labs(title = "OD Connections with Avg Occupancy",
x = "Longitude",
y = "Latitude")
ggplot() +
geom_sf(data = stations_sf, color = "black", size = 1) +
geom_sf(data = od_lines, aes(color = avg_occupancy), size = 2, alpha = 0.7) +
scale_color_gradient(low = "grey80", high = "firebrick") +
theme_minimal() +
labs(title = "OD Connections with Avg Occupancy",
x = "Longitude",
y = "Latitude")
ggplot() +
geom_sf(data = stations_sf, color = "black", size = 1) +
geom_sf(data = od_lines, aes(color = avg_occupancy, size = count), alpha = 0.7) +
scale_color_gradient(low = "grey80", high = "firebrick") +
theme_minimal() +
labs(title = "OD Connections with Avg Occupancy",
x = "Longitude",
y = "Latitude")
ggplot() +
geom_sf(data = stations_sf, color = "black", size = 1) +
geom_sf(data = od_lines, aes(color = avg_occupancy), size = 5, alpha = 0.7) +
scale_color_gradient(low = "grey80", high = "firebrick") +
theme_minimal() +
labs(title = "OD Connections with Avg Occupancy",
x = "Longitude",
y = "Latitude")
ggplot() +
geom_sf(data = stations_sf, color = "black", size = 1) +
geom_sf(data = od_lines, aes(color = avg_occupancy, size = count), alpha = 0.7) +
scale_color_gradient(low = "grey80", high = "firebrick") +
scale_size(range = c(0.5, 5), guide = "legend") +  # 调整线宽范围
theme_minimal() +
labs(
title = "OD Connections with Avg Occupancy",
x = "Longitude",
y = "Latitude",
size = "Count"  # 添加图例标签
)
ggplot() +
geom_sf(data = stations_sf, color = "black", size = 1) +
geom_sf(data = od_lines, aes(color = avg_occupancy, size = count), alpha = 0.7) +
scale_color_gradient(low = "grey80", high = "firebrick") +
theme_minimal() +
labs(title = "OD Connections with Avg Occupancy",
x = "Longitude",
y = "Latitude") %>%
ggsave("OD_Connections.png", plot = plot, width = 10, height = 7, dpi = 300)
ggplot() +
geom_sf(data = stations_sf, color = "black", size = 1) +
geom_sf(data = od_lines, aes(color = avg_occupancy, size = count), alpha = 0.7) +
scale_color_gradient(low = "grey80", high = "firebrick") +
theme_minimal() +
labs(title = "OD Connections with Avg Occupancy",
x = "Longitude",
y = "Latitude") %>%
ggsave("OD_Connections.png", ., width = 10, height = 7, dpi = 300)
plot <- ggplot() +
geom_sf(data = stations_sf, color = "black", size = 1) +
geom_sf(data = od_lines, aes(color = avg_occupancy, size = count), alpha = 0.7) +
scale_color_gradient(low = "grey80", high = "firebrick") +
theme_minimal() +
labs(title = "OD Connections with Avg Occupancy",
x = "Longitude",
y = "Latitude")
ggsave("OD_Connections.png", plot = plot, width = 10, height = 7, dpi = 300)
ggplot() +
geom_sf(data = stations_sf, color = "black", size = 1) +
geom_sf(data = od_lines, aes(color = avg_occupancy, linewidth = count), alpha = 0.7) +
scale_color_gradient(low = "grey80", high = "firebrick") +
theme_minimal() +
labs(title = "OD Connections with Avg Occupancy",
x = "Longitude",
y = "Latitude")
od_data <- data %>%
group_by(OD) %>%
#filter(n() > 3) %>%
summarize(
count = n(),
avg_occupancy = mean(occupancy_classifier, na.rm = TRUE),
from = first(from),
to = first(to)
)
od_with_coords <- od_data %>%
left_join(stations, by = c("from" = "code")) %>%
rename(from_long = longitude, from_lat = latitude) %>%
left_join(stations, by = c("to" = "code")) %>%
rename(to_long = longitude, to_lat = latitude)
od_lines <- od_with_coords %>%
filter(!is.na(from_long) & !is.na(to_long)) %>%
rowwise() %>%
mutate(geometry = st_sfc(st_linestring(matrix(c(from_long, from_lat, to_long, to_lat), ncol = 2, byrow = TRUE)), crs = 4326)) %>%
st_as_sf()
ggplot() +
geom_sf(data = stations_sf, color = "black", size = 1) +
geom_sf(data = od_lines, aes(color = avg_occupancy, linewidth = count), alpha = 0.7) +
scale_color_gradient(low = "grey80", high = "firebrick") +
theme_minimal() +
labs(title = "OD Connections with Avg Occupancy",
x = "Longitude",
y = "Latitude")
ggsave("OD_Connections.png", plot = plot, width = 10, height = 7, dpi = 300)
plot <- ggplot() +
geom_sf(data = stations_sf, color = "black", size = 1) +
geom_sf(data = od_lines, aes(color = avg_occupancy, linewidth = count), alpha = 0.7) +
scale_color_gradient(low = "grey80", high = "firebrick") +
theme_minimal() +
labs(title = "OD Connections with Avg Occupancy",
x = "Longitude",
y = "Latitude")
ggsave("OD_Connections.png", plot = plot, width = 10, height = 7, dpi = 300)
ggplot() +
geom_sf(data = stations_sf, color = "black", size = 1) +
geom_sf(data = od_lines, aes(color = avg_occupancy, linewidth = count), alpha = 0.9) +
scale_color_gradient(low = "grey80", high = "firebrick") +
theme_minimal() +
labs(title = "OD Connections with Avg Occupancy",
x = "Longitude",
y = "Latitude")
ggplot() +
geom_sf(data = od_lines, aes(color = avg_occupancy, linewidth = count), alpha = 0.9) +
geom_sf(data = stations_sf, color = "black", size = 2) +
scale_color_gradient(low = "grey80", high = "firebrick") +
theme_minimal() +
labs(title = "OD Connections with Avg Occupancy",
x = "Longitude",
y = "Latitude")
ggplot() +
geom_sf(data = od_lines, aes(color = avg_occupancy, linewidth = count), alpha = 0.9) +
geom_sf(data = stations_sf, color = "black", size = 1) +
scale_color_gradient(low = "grey80", high = "firebrick") +
theme_minimal() +
labs(title = "OD Connections with Avg Occupancy",
x = "Longitude",
y = "Latitude")
ggplot() +
geom_sf(data = stations_sf, color = "black", size = 1) +
geom_sf(data = od_lines, aes(color = avg_occupancy, linewidth = count), alpha = 0.9) +
scale_color_gradient(low = "grey80", high = "firebrick") +
theme_minimal() +
labs(title = "OD Connections with Avg Occupancy",
x = "Longitude",
y = "Latitude")
ggplot() +
geom_sf(data = stations_sf, color = "black", size = 1) +
geom_sf(data = od_lines, aes(color = avg_occupancy, linewidth = count), alpha = 0.5) +
scale_color_gradient(low = "grey80", high = "firebrick") +
theme_minimal() +
labs(title = "OD Connections with Avg Occupancy",
x = "Longitude",
y = "Latitude")
ggplot() +
geom_sf(data = stations_sf, color = "black", size = 1) +
geom_sf(data = od_lines, aes(color = avg_occupancy, linewidth = count), alpha = 0.8) +
scale_color_gradient(low = "grey80", high = "firebrick") +
theme_minimal() +
labs(title = "OD Connections with Avg Occupancy",
x = "Longitude",
y = "Latitude")
ggplot() +
geom_sf(data = stations_sf, color = "black", size = 1) +
geom_sf(data = od_lines, aes(color = avg_occupancy, alpha = count)) +
scale_color_gradient(low = "grey80", high = "firebrick") +
theme_minimal() +
labs(title = "OD Connections with Avg Occupancy",
x = "Longitude",
y = "Latitude")
ggplot() +
geom_sf(data = stations_sf, color = "black", size = 1) +
geom_sf(data = od_lines, aes(color = avg_occupancy, alpha = count), linewidth = 2) +
scale_color_gradient(low = "grey80", high = "firebrick") +
theme_minimal() +
labs(title = "OD Connections with Avg Occupancy",
x = "Longitude",
y = "Latitude")
ggplot() +
geom_sf(data = stations_sf, color = "black", size = 1) +
geom_sf(data = od_lines, aes(color = avg_occupancy, alpha = count), linewidth = 1) +
scale_color_gradient(low = "grey80", high = "firebrick") +
theme_minimal() +
labs(title = "OD Connections with Avg Occupancy",
x = "Longitude",
y = "Latitude")
ggplot() +
geom_sf(data = stations_sf, color = "black", size = 1) +
geom_sf(data = od_lines, aes(color = avg_occupancy, alpha = count), linewidth = 1) +
scale_alpha(range = c(0.5, 1), guide = "legend") +
scale_color_gradient(low = "grey80", high = "firebrick") +
theme_minimal() +
labs(title = "OD Connections with Avg Occupancy",
x = "Longitude",
y = "Latitude")
ggplot() +
geom_sf(data = stations_sf, color = "black", size = 1) +
geom_sf(data = od_lines, aes(color = avg_occupancy, alpha = count), linewidth = 1) +
scale_alpha(range = c(0.3, 1), guide = "legend") +
scale_color_gradient(low = "grey80", high = "firebrick") +
theme_minimal() +
labs(title = "OD Connections with Avg Occupancy",
x = "Longitude",
y = "Latitude")
ggplot() +
geom_sf(data = stations_sf, color = "black", size = 2) +
geom_sf(data = od_lines, aes(color = avg_occupancy, alpha = count), linewidth = 1) +
scale_alpha(range = c(0.3, 1), guide = "legend") +
scale_color_gradient(low = "grey80", high = "firebrick") +
theme_minimal() +
labs(title = "OD Connections with Avg Occupancy",
x = "Longitude",
y = "Latitude")
ggplot() +
geom_sf(data = stations_sf, color = "black", size = 1.5) +
geom_sf(data = od_lines, aes(color = avg_occupancy, alpha = count), linewidth = 1) +
scale_alpha(range = c(0.3, 1), guide = "legend") +
scale_color_gradient(low = "grey80", high = "firebrick") +
theme_minimal() +
labs(title = "OD Connections with Avg Occupancy",
x = "Longitude",
y = "Latitude")
ggplot() +
geom_sf(data = stations_sf, color = "black", size = 1.5) +
geom_sf(data = od_lines, aes(color = avg_occupancy, alpha = count), linewidth = 1) +
scale_alpha(range = c(0.2, 1), guide = "legend") +
scale_color_gradient(low = "grey80", high = "firebrick") +
theme_minimal() +
labs(title = "OD Connections with Avg Occupancy",
x = "Longitude",
y = "Latitude")
ggplot() +
geom_sf(data = stations_sf, color = "black", size = 1.5) +
geom_sf(data = od_lines, aes(color = avg_occupancy, alpha = count), linewidth = 1) +
scale_alpha(range = c(0.4, 1), guide = "legend") +
scale_color_gradient(low = "grey80", high = "firebrick") +
theme_minimal() +
labs(title = "OD Connections with Avg Occupancy",
x = "Longitude",
y = "Latitude")
be <- st_read("path/to/be.shp")
be <- st_read("be.shp") %>% st_transform(crs = 4326)
ggplot() +
geom_sf(data = be)
ggplot() +
geom_sf(data = be, color = "white", alpha = 0.5) +
geom_sf(data = stations_sf, color = "black", size = 1.5) +
geom_sf(data = od_lines, aes(color = avg_occupancy, alpha = count), linewidth = 1) +
scale_alpha(range = c(0.4, 1), guide = "legend") +
scale_color_gradient(low = "grey80", high = "firebrick") +
theme_minimal() +
labs(title = "OD Connections with Avg Occupancy",
x = "Longitude",
y = "Latitude")
ggplot() +
geom_sf(data = be, color = "white", alpha = 0.8) +
geom_sf(data = stations_sf, color = "black", size = 1.5) +
geom_sf(data = od_lines, aes(color = avg_occupancy, alpha = count), linewidth = 1) +
scale_alpha(range = c(0.4, 1), guide = "legend") +
scale_color_gradient(low = "grey80", high = "firebrick") +
theme_minimal() +
labs(title = "OD Connections with Avg Occupancy",
x = "Longitude",
y = "Latitude")
ggplot() +
geom_sf(data = be, color = "white", alpha = 0.5) +
geom_sf(data = stations_sf, color = "black", size = 1.5) +
geom_sf(data = od_lines, aes(color = avg_occupancy, alpha = count), linewidth = 1) +
scale_alpha(range = c(0.4, 1), guide = "legend") +
scale_color_gradient(low = "grey80", high = "firebrick") +
theme_minimal() +
labs(title = "OD Connections with Avg Occupancy",
x = "Longitude",
y = "Latitude")
train_type <- data %>%
group_by(type) %>%
summarize(count = n(),
avg = mean(occupancy_classifier, na.rm = TRUE))
View(train_type)
data <- data %>%
mutate(type = case_when(
type %in% c("ICE", "ICT", "ic") ~ "IC",
type %in% c("THA", "TRN", "Extra") ~ "Other",
TRUE ~ type
))
train_type <- data %>%
group_by(type) %>%
summarize(count = n(),
avg = mean(occupancy_classifier, na.rm = TRUE))
View(train_type)
ggplot(train_type, aes(x = fct_reorder(type, avg, .desc = TRUE), y = avg, fill = type)) +
geom_col(show.legend = FALSE) +
labs(
title = "Average Occupancy by Train Type",
x = "Train Type",
y = "Average Occupancy"
) +
theme_minimal()
ggplot(train_type, aes(x = fct_reorder(type, avg, .desc = TRUE), y = avg)) +
geom_col(show.legend = FALSE) +
labs(
title = "Average Occupancy by Train Type",
x = "Train Type",
y = "Average Occupancy"
) +
theme_minimal()
ggplot(train_type, aes(x = fct_reorder(type, avg, .desc = TRUE), y = avg)) +
geom_col(position = position_dodge(width = 0.9), show.legend = FALSE, width = 0.7) +
labs(
title = "Average Occupancy by Train Type",
x = "Train Type",
y = "Average Occupancy"
) +
theme_minimal()
ggplot(train_type, aes(x = fct_reorder(type, avg, .desc = TRUE), y = avg)) +
geom_col(position = position_dodge(width = 0.9), show.legend = FALSE, width = 0.9) +
labs(
title = "Average Occupancy by Train Type",
x = "Train Type",
y = "Average Occupancy"
) +
theme_minimal()
ggplot(train_type, aes(x = fct_reorder(type, avg, .desc = TRUE), y = avg)) +
geom_col(position = position_dodge(width = 0.7), show.legend = FALSE, width = 0.7) +
labs(
title = "Average Occupancy by Train Type",
x = "Train Type",
y = "Average Occupancy"
) +
theme_minimal()
plot(data$Temperature, data$high_occupancy_rate)
